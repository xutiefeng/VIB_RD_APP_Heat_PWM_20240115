
/****************************************Copyright (c)****************************************************
**                            Guangzhou ZHIYUAN electronics Co.,LTD.
**
**                                 http://www.zlgmcu.com
**
**--------------File Info---------------------------------------------------------------------------------
** File name:           Crc.c
** Last modified Date:  2011-12-01
** Last Version:        V1.00
** Descriptions:        
**
**--------------------------------------------------------------------------------------------------------
** Created by:          zhaohai
** Created date:        2011-12-01
** Version:             V1.00
** Descriptions:
**
**--------------------------------------------------------------------------------------------------------
** Modified by:
** Modified date:
** Version:
** Descriptions:
**
** Rechecked by:
*********************************************************************************************************/
#include "..\includeall.h"

/*********************************************************************************************************
** 全局定量
*********************************************************************************************************/
#ifdef  CRC_CRC7_TAB_EN
const INT8U     CRC_CRC7_TAB[256] = {
    0x00,0x09,0x12,0x1B,0x24,0x2D,0x36,0x3F,0x48,0x41,0x5A,0x53,0x6C,0x65,0x7E,0x77,
    0x19,0x10,0x0B,0x02,0x3D,0x34,0x2F,0x26,0x51,0x58,0x43,0x4A,0x75,0x7C,0x67,0x6E,
    0x32,0x3B,0x20,0x29,0x16,0x1F,0x04,0x0D,0x7A,0x73,0x68,0x61,0x5E,0x57,0x4C,0x45,
    0x2B,0x22,0x39,0x30,0x0F,0x06,0x1D,0x14,0x63,0x6A,0x71,0x78,0x47,0x4E,0x55,0x5C,
    0x64,0x6D,0x76,0x7F,0x40,0x49,0x52,0x5B,0x2C,0x25,0x3E,0x37,0x08,0x01,0x1A,0x13,
    0x7D,0x74,0x6F,0x66,0x59,0x50,0x4B,0x42,0x35,0x3C,0x27,0x2E,0x11,0x18,0x03,0x0A,
    0x56,0x5F,0x44,0x4D,0x72,0x7B,0x60,0x69,0x1E,0x17,0x0C,0x05,0x3A,0x33,0x28,0x21,
    0x4F,0x46,0x5D,0x54,0x6B,0x62,0x79,0x70,0x07,0x0E,0x15,0x1C,0x23,0x2A,0x31,0x38,
    0x41,0x48,0x53,0x5A,0x65,0x6C,0x77,0x7E,0x09,0x00,0x1B,0x12,0x2D,0x24,0x3F,0x36,
    0x58,0x51,0x4A,0x43,0x7C,0x75,0x6E,0x67,0x10,0x19,0x02,0x0B,0x34,0x3D,0x26,0x2F,
    0x73,0x7A,0x61,0x68,0x57,0x5E,0x45,0x4C,0x3B,0x32,0x29,0x20,0x1F,0x16,0x0D,0x04,
    0x6A,0x63,0x78,0x71,0x4E,0x47,0x5C,0x55,0x22,0x2B,0x30,0x39,0x06,0x0F,0x14,0x1D,
    0x25,0x2C,0x37,0x3E,0x01,0x08,0x13,0x1A,0x6D,0x64,0x7F,0x76,0x49,0x40,0x5B,0x52,
    0x3C,0x35,0x2E,0x27,0x18,0x11,0x0A,0x03,0x74,0x7D,0x66,0x6F,0x50,0x59,0x42,0x4B,
    0x17,0x1E,0x05,0x0C,0x33,0x3A,0x21,0x28,0x5F,0x56,0x4D,0x44,0x7B,0x72,0x69,0x60,
    0x0E,0x07,0x1C,0x15,0x2A,0x23,0x38,0x31,0x46,0x4F,0x54,0x5D,0x62,0x6B,0x70,0x79
};
#endif
#ifdef  CRC_CRC8_TAB_EN
const INT8U     CRC_CRC8_TAB[256] = {
    0x42,0x6D,0x1C,0x33,0xFE,0xD1,0xA0,0x8F,0x15,0x3A,0x4B,0x64,0xA9,0x86,0xF7,0xD8,
    0xEC,0xC3,0xB2,0x9D,0x50,0x7F,0x0E,0x21,0xBB,0x94,0xE5,0xCA,0x07,0x28,0x59,0x76,
    0x31,0x1E,0x6F,0x40,0x8D,0xA2,0xD3,0xFC,0x66,0x49,0x38,0x17,0xDA,0xF5,0x84,0xAB,
    0x9F,0xB0,0xC1,0xEE,0x23,0x0C,0x7D,0x52,0xC8,0xE7,0x96,0xB9,0x74,0x5B,0x2A,0x05,
    0xA4,0x8B,0xFA,0xD5,0x18,0x37,0x46,0x69,0xF3,0xDC,0xAD,0x82,0x4F,0x60,0x11,0x3E,
    0x0A,0x25,0x54,0x7B,0xB6,0x99,0xE8,0xC7,0x5D,0x72,0x03,0x2C,0xE1,0xCE,0xBF,0x90,
    0xD7,0xF8,0x89,0xA6,0x6B,0x44,0x35,0x1A,0x80,0xAF,0xDE,0xF1,0x3C,0x13,0x62,0x4D,
    0x79,0x56,0x27,0x08,0xC5,0xEA,0x9B,0xB4,0x2E,0x01,0x70,0x5F,0x92,0xBD,0xCC,0xE3,
    0xA1,0x8E,0xFF,0xD0,0x1D,0x32,0x43,0x6C,0xF6,0xD9,0xA8,0x87,0x4A,0x65,0x14,0x3B,
    0x0F,0x20,0x51,0x7E,0xB3,0x9C,0xED,0xC2,0x58,0x77,0x06,0x29,0xE4,0xCB,0xBA,0x95,
    0xD2,0xFD,0x8C,0xA3,0x6E,0x41,0x30,0x1F,0x85,0xAA,0xDB,0xF4,0x39,0x16,0x67,0x48,
    0x7C,0x53,0x22,0x0D,0xC0,0xEF,0x9E,0xB1,0x2B,0x04,0x75,0x5A,0x97,0xB8,0xC9,0xE6,
    0x47,0x68,0x19,0x36,0xFB,0xD4,0xA5,0x8A,0x10,0x3F,0x4E,0x61,0xAC,0x83,0xF2,0xDD,
    0xE9,0xC6,0xB7,0x98,0x55,0x7A,0x0B,0x24,0xBE,0x91,0xE0,0xCF,0x02,0x2D,0x5C,0x73,
    0x34,0x1B,0x6A,0x45,0x88,0xA7,0xD6,0xF9,0x63,0x4C,0x3D,0x12,0xDF,0xF0,0x81,0xAE,
    0x9A,0xB5,0xC4,0xEB,0x26,0x09,0x78,0x57,0xCD,0xE2,0x93,0xBC,0x71,0x5E,0x2F,0x00
};
#endif

/*********************************************************************************************************
** 全局变量
*********************************************************************************************************/

/*********************************************************************************************************
** Function name:       Crc_Crc7
** Descriptions:        CRC7计算,多项式 (x^7 + x^3 + 1)
** input parameters:    ucCrcInit:  Crc初值
**                      *pucDat:    数据首地址
**                      ulLen:      数据长度
** output parameters:   无
** Returned value:      7位Crc结果
*********************************************************************************************************/
INT8U   Crc_Crc7(INT8U ucCrcInit, INT8U *pucDat, INT32U ulLen)
#if CRC_CRC7_TAB_EN
{
    INT8U   ucCrc7 = ucCrcInit;
    
    while (ulLen--) {
        ucCrc7 = CRC_CRC7_TAB[(ucCrc7 << 1) ^ (*pucDat++)];
    }
    
    return ucCrc7;
}
#else
{
    INT32U  i, j;
    INT8U   ucCrc7 = ucCrcInit;
    
    for (i = 0; i < ulLen; i++) {
        for (j = 0; j < 8; j++) {
            ucCrc7 <<= 1;
            ucCrc7 ^= ((((*(pucDat + i) << j) ^ ucCrc7) & 0x80) ? 0x9 : 0);
        }
    }
    
    return (ucCrc7 & 0x7F);
}
#endif
/*********************************************************************************************************
** Function name:       Crc_Crc8
** Descriptions:        CRC8计算,多项式 (x^8 + x^5 + x^3 + x^2 + x^1 + 1)
** input parameters:    ucCrcInit:  Crc初值
**                      *pucDat:    数据首地址
**                      ulLen:      数据长度
** output parameters:   无
** Returned value:      8位Crc结果
*********************************************************************************************************/
INT8U   Crc_Crc8(INT8U ucCrcInit, INT8U *pucDat, INT32U ulLen)
#if CRC_CRC8_TAB_EN
{
	INT8U   ucCrc8 = ucCrcInit;
    
    while (ulLen--) {
        ucCrc8  = CRC_CRC8_TAB[ucCrc8 ^ (*pucDat++)];
    }
    
    return ucCrc8;
}
#else
{
    INT32U  i, j;
    INT8U   ucCrc8 = ucCrcInit;
    INT8U   ucGenPoly = 0x2F;
    
    ucGenPoly = 0x2F;
    for (i = 0; i < ulLen; i++) {
        ucCrc8  ^= *pucDat++;
        for (j = 0; j < 8; j++) {
            if (ucCrc8 & 0x80) {
                ucCrc8 = (ucCrc8 << 1) ^ ucGenPoly;
            } else {
                ucCrc8 <<= 1;
            }
        }
    }
    // ucGenPoly = 0xF4;
    // for (i = 0; i < ulLen; i++) {
        // ucCrc8  ^= *pucDat++;
        // for (j = 0; j < 8; j++) {
            // if (ucCrc8 & 0x01) {
                // ucCrc8 = (ucCrc8 >> 1) ^ ucGenPoly;
            // } else {
                // ucCrc8 >>= 1;
            // }
        // }
    // }
    
    return ucCrc8;
}
#endif

/*********************************************************************************************************
** END FILE
*********************************************************************************************************/
